<!DOCTYPE html>
<html lang="en" ng-app="inquiryApp" ng-controller="inquiryCon">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,user-scalable=no">
<link href="../../css/style.css" rel="stylesheet" type="text/css">
<link href="../../css/ionic.css" rel="stylesheet" type="text/css">
<link href="../../css/mui.min.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../css/touchTouch.css" />
<script src="../../js/jquery-1.12.3.min.js"></script>
<script src="../..//js/touchTouch.jquery.js"></script>
<script src="../../js/iscroll.js"></script>
<script type="text/javascript" src="../../js/ionic.js"></script>
<script type="text/javascript" src="../../js/mui.min.js"></script>
<script src="../../js/util.js"></script>
<script src="../../js/angular-sanitize.min.js"></script>
<script type="text/javascript" src="../../js/im/webim.js"></script>
<script type="text/javascript" src="../../js/im/json2.js"></script>
<script type="text/javascript" src="../../js/im/login.js"></script>
<script type="text/javascript" src="../../js/im/spark-md5.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<style type="text/css">
body{
	max-width:9999px;
	min-width:1px;
}
.inquiry_doctor h3{
		font-size: 0.875rem;
	}
	.inquiry_doctor p{
		font-size: 0.75rem
	}
	.inquiry_case h3{
		font-size: 0.875rem;
	}
	.inquiry_case p{
		font-size: 0.75rem
	}
	.inquiry_describe h3{
		font-size: 0.875rem;
	}


.marginBottom{
	margin-bottom: 42px;
}
.scroll-content{top: 3.375rem;}
.inquiry_hint_time{margin:1rem 0.675rem;}
.inquiry_hint_time p{height: 1.375rem;width: auto;border-radius: 22px;display: inline-block;padding-left:1rem;background:rgba(68,68,68,0.6) url(../../img/count_down.png)no-repeat left center;background-size: 1.3rem 1.3rem;}
.inquiry_hint_time p span{font-size: 0.687rem;color: #fff;padding: 0 1rem 0 0.6rem;line-height: 1.375rem;height: 1.375rem;display: inline-block;}
.inquiry_hint_time .inquiry_hint_number{background:rgba(68,68,68,0.6) url(../../img/number.png)no-repeat left center;background-size: 1.3rem 1.3rem;}

@media screen and (max-device-width: 640px){body{-webkit-text-size-adjust:none;}}
</style>
<title>在线交流</title>
</head>
<body class="notice_back" ng-init="stop=false;isSendShow=2" style="overflow: hidden;" ng-cloak ng-click="showSend($event,2)">
	<div id="inquiry">
		<div class="inquiry_top">
			<div class="inquiry_photo" ng-click="toDoctor()">
				<img ng-src="{{doctor.docUrl}}">
			</div>
			<div class="inquiry_doctor" ng-cloak>
				<h3>
					{{doctor.docName  |limitTo:5}}<span>{{doctor.docPosition}}</span>
				</h3>
				<p>{{doctor.infirmaryName}}</p>
			</div>
			<div class="inquiry_case">
				<h3 ng-bind="patient.name | limitTo:5"></h3>
				<p ng-click="toCasehistory()">我的健康档案</p>
			</div>
		</div>
		<div class="inquiry_con">
		
			<div  class="inquiry_hint_time" class="inquiry_hint_time" ng-if="lastOrder.serverId==4&&lastOrder.paymentStatus==2">
				<p>
					<span>本次图文调理服务将于{{dayNum}}后自动结束</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" class="inquiry_hint_time" ng-if="lastOrder.serverId==22&&lastOrder.paymentStatus==2">
				<p>
					<span>本次现场抄方服务将于{{dayNum}}后自动结束</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==4&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==6&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前图文咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==7&&lastOrder.paymentStatus==2">
				<p>
					<span>本次电话调理服务将于{{dayNum}}后自动结束</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==8&&lastOrder.paymentStatus==2">
				<p>
					<span>本次电话咨询服务将于{{dayNum}}后自动结束</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==7&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==8&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前电话咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==21&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div>
			
			<div  class="inquiry_hint_time" ng-if="lastOrder.serverId==22&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div>
			
			<!-- <div  class="inquiry_hint_time" ng-if="lastOrder.serverId==22&&lastOrder.syZxCount>0">
				<p class="inquiry_hint_number">
					<span>当前咨询还剩{{lastOrder.syZxCount}}次</span>
				</p>
			</div> -->
			
			<div class="inquiry_hint_time" ng-if="lastOrder.paymentStatus==5&&lastOrder.syZxCount<=0">
				<!-- <p class="inquiry_hint_number">
					<span>当前咨询已结束</span>
				</p> -->
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==4">
					<span>当前图文调理服务已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==5">
					<span>当前图文复诊服务询已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==6">
					<span>当前图文咨询服务已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==7">
					<span>当前电话调理服务已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==8">
					<span>当前电话咨询服务已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==9">
					<span>当前电话复诊服务已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==21">
					<span>当前直接开方服务已结束</span>
				</p>
				<p class="inquiry_hint_number" ng-if="lastOrder.serverId==22">
					<span>当前现场抄方服务已结束</span>
				</p>
			</div>
			
			<div class="inquiry_main">
				<ion-content ng-class="{true:'marginBottom'}[(lastOrder.serverId!=4&&lastOrder.serverId!=7&&lastOrder.syZxCount>0)||(lastOrder.serverId==4&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)||(lastOrder.serverId==7&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)]">
				<ion-refresher pulling-text="下拉刷新" on-refresh="doRefresh()" disable-pull-rotation="stop"></ion-refresher>
					<!-- <div class="inquiry_hint">
						<p ng-if="lastOrder.serverId==4&&lastOrder.paymentStatus==2">
							图文调理还剩：<span ng-bind-html="dayNum"></span>
						</p>
						<p ng-if="lastOrder.serverId==4&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0">
							诊后咨询还剩：<span>{{lastOrder.syZxCount}}次</span>
						</p>
						<p ng-if="lastOrder.serverId==6&&lastOrder.syZxCount>0">
							图文咨询还剩：<span>{{lastOrder.syZxCount}}次</span>
						</p>
						<p ng-if="lastOrder.serverId==7&&lastOrder.paymentStatus==2">
							电话调理还剩：<span ng-bind-html="dayNum"></span>
						</p>
						<p ng-if="lastOrder.serverId==7&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0">
							诊后咨询还剩：<span>{{lastOrder.syZxCount}}次</span>
						</p>
						<p ng-if="lastOrder.serverId==8&&lastOrder.syZxCount>0">
							电话咨询还剩：<span>{{lastOrder.syZxCount}}次</span>
						</p>
						<p ng-if="lastOrder.serverId==21&&lastOrder.syZxCount>0">
							诊后咨询还剩：<span>{{lastOrder.syZxCount}}次</span>
						</p>
						<p ng-if="lastOrder.serverId==22&&lastOrder.syZxCount>0">
							诊后咨询还剩：<span>{{lastOrder.syZxCount}}次</span>
						</p>
					</div> -->
					<ul class="inquiry_chat">
						<div ng-repeat="msg in msgs track by $index" render-finish>
								<li ng-if="$index==0||equals(msg.msgTime,msgs[$index-1].msgTime)" ng-cloak>
									<p class="inquiry_time"><span ng-bind="msg.time" ng-init="msg.showTime=msg.msgTime" time="{{msg.msgTime}}"></span></p>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==1">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con inquiry_chatext">
										<pre class="inquiry_accept" ng-bind="msg.content"></pre>
										<span class="inquiry_point"></span>
									</div>
								</li>
								
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==2">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con inquiry_chatext">
										<div class="inquiry_img" href="{{msg.bigPictureUrl}}">
											<img ng-src="{{msg.shrinkingMapUrl}}" class="chat_photo" msgId="{{msg.id}}">
										</div>
										<span class="inquiry_point"></span>
									</div>
								</li>
								
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==3">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con inquiry_chatext" onclick="payAudio(this)">
										<i class="inquiry_voicebtn">
											<audio ng-src="{{sce(msg.content)}}" cid="{{msg.id}}" style="width: 100%;height:100%;opacity:0;" preload="none"></audio>
										</i>
										<h4 class="inquiry_time2">{{msg.second}}"</h4>
										<a class="inquiry_voiceleft"></a>
										<span class="inquiry_point"></span>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==6">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<div class="inquiry_describe">
											<h3>症状描述</h3>2.0
											<p>请认真如实填写，<br>以便准确为您辩证。</p>
										</div>
										<p class="inquiry_look" ng-click="searchSymptom(msg.orderNo)">查看</p>
										<span class="inquiry_point"></span>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==7">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<div class="inquiry_describe">
											<h3>症状描述<span>已完成</span></h3>
											<p>完成度：{{msg.content}}/3</p>
										</div>
										<p class="inquiry_look" ng-click="searchSymptom(msg.orderNo)">查看</p>
										<span class="inquiry_point"></span>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==8">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle see_width">
												<img src="../../img/describe.png">
												<div class="history_billtext">
													<h3>问诊单<span>请详实填写问诊单，这样我能更准确地了解您的情况，为您准确处方</span></h3>
													<!-- <p>以便真确为您辩证</p> -->
												</div>
											</div>
											<span class="history_look" ng-click="searchSpecialTest(msg.orderNo,msg.dataId,'问诊单')">查看</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==9">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle see_width">
												<img src="../../img/describe.png">
												<div class="history_billtext">
													<h3>问诊单<span></span></h3>
													<p>已完成</p>
												</div>
											</div>
											<span class="history_look" ng-click="searchSpecialTest(msg.orderNo,msg.dataId,'问诊单')">查看</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==10">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle see_width">
												<img src="../../img/describe.png">
												<div class="history_billtext">
													<h3>复诊单<span>请详实填写问诊单，这样我能更准确地了解您的情况，为您准确处方</span></h3>
													<!-- <p>以便真确为您辩证</p> -->
												</div>
											</div>
											<span class="history_look" ng-click="searchSpecialTest(msg.orderNo,msg.dataId,'复诊单')">查看</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==11">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle see_width">
												<img src="../../img/describe.png">
												<div class="history_billtext">
													<h3>复诊单<span>请详实填写问诊单，这样我能更准确地了解您的情况，为您准确处方</span></h3>
													<p>已完成</p>
												</div>
											</div>
											<span class="history_look" ng-click="searchSpecialTest(msg.orderNo,msg.dataId,'复诊单')">查看</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==12">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle">
												<img src="../../img/describe.png">
												<div class="history_billtext">
													<h3>调理方案<span></span></h3>
													<p>￥{{msg.content|numFilter}}</p>
												</div>
											</div>
											<span class="history_look" ng-click="toPayConditioning(msg.orderNo)">立即支付</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==13">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle">
												<img src="../../img/describe.png">
												<div class="history_billtext">
													<h3>调理方<span></span></h3>
													<p>￥{{msg.content|numFilter}}</p>
												</div>
											</div>
											<span class="history_look" ng-click="toPayConditioning(msg.orderNo,msg.dataId)">查看</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==14">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											您获得医生赠送的{{msg.content}}次免费诊后咨询，请于48小时内完成次免费咨询
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==15">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<div class="inquiry_describe">
											<h3>补交挂号费</h3>
											<p>￥{{msg.content}}</p>
										</div>
										<p class="inquiry_look" ng-click="toPayment(msg.orderNo,msg.content)">去支付</p>
										<span class="inquiry_point"></span>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==16">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<div class="inquiry_describe">
											<h3>补缴挂号费</h3>
											<p>￥{{msg.content}}</p>
										</div>
										<p class="inquiry_look">已支付</p>
										<span class="inquiry_point"></span>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==17">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											<!-- 本次调理服务已结束，如仍有需求，可在线咨询管理病情 -->
											您本次购买的服务时间已结束，请遵循医嘱进行调理，您可关注医生主页获取更多健康常识
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==18">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											{{msg.from_account==patient.id?'你':'对方'}}撤回了一条消息
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-click="toKnowledge(msg.dataId)" ng-cloak ng-if="msg.msgType==19">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con inquiry_chatext">
										<div class="inquiry_goods">
											<div style=" width:3.5rem;height: 3.5rem;margin-right: 0.6rem;display:  table;overflow:hidden;border: 1px solid #eee;position:  relative;">
												<img ng-src="{{null==msg.height||''==msg.height?'../../img/logo1.png':msg.height}}">
											</div>
											<div class="inquiry_article">
												<h3 ng-bind="msg.width"></h3>
												<span><strong ng-bind="msg.bigPictureUrl"></strong><i ng-bind="msg.originalUrl"></i><i ng-bind="msg.shrinkingMapUrl"></i></span>
												<p ng-bind="msg.content"></p>
											</div>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-click="toGoods(msg.dataId)" ng-cloak ng-if="msg.msgType==20">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con inquiry_chatext">
										<div class="inquiry_goods">
											<div style=" width:3.5rem;height: 3.5rem;margin-right:1.5rem;display:  table;overflow:hidden;border: 1px solid #eee;position:  relative;">
												<img ng-src="{{msg.bigPictureUrl}}">
											</div>
											<div class="inquiry_goods_detail">
												<h3 ng-bind="msg.content"></h3>
												<p>￥{{msg.shrinkingMapUrl}}</p>
											</div>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==21">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<div class="inquiry_describe">
											<h3>{{doctor.docName  |limitTo:5}}医生</h3>
											<p>线下坐诊信息</p>
										</div>
										<p class="inquiry_look" ng-click="toBelow(msg.dataId)">查看</p>
										<span class="inquiry_point"></span>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==23">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p ng-if="msg.type==4">
											您已成功购买图文调理服务，医生将尽快与您沟通，请留意上医仁家公众号向您发送的提示信息；如有疑问请联系客服400-667-0099
										</p>
										<p ng-if="msg.type==7">
											您已成功购买电话调理服务，上医仁家平台将在30分钟内致电与您确认调理服务时间，请留意您的来电哦
										</p>
										<p ng-if="msg.type==6">
											您已成功购买图文咨询服务，请提交您的问题，医生将尽快与您沟通，请留意上医仁家公众号向您发送的提示信息；如有疑问请联系客服400-667-0099
										</p>
										<p ng-if="msg.type==8">
											您已成功购买电话咨询服务，上医仁家平台将在30分钟内致电与您确认咨询服务时间，请留意您的来电哦
										</p>
										<p ng-if="msg.type!=4&&msg.type!=7&&msg.type!=6&&msg.type!=8">
											您已成功购买{{msg.content}}服务
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==24">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											{{msg.content}}
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==25">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											{{msg.content}}
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==26">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											{{msg.content}}
										</p>
									</div>
								</li>
								
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==27">
									<div class="inquiry_icon">
										<img ng-src="{{msg.from_account==patient.id?patient.photo:doctor.docUrl}}">
									</div>
									<div class="inquiry_chat_con">
										<span class="inquiry_point"></span>
										<div class="history_bill">
											<div class="history_billtitle see_width careful_billtitle">
												<img src="../../img/careful.png">
												<div class="history_billtext careful_billtext">
													<h3>服药禁忌</h3>
												</div>
											</div>
											<span class="history_look" ng-click="be_careful()">查看</span>
										</div>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==28">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											{{msg.content}}
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==29">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											{{msg.content}}
										</p>
									</div>
								</li>
								<li ng-class="{true:'inquiry_mine'}[msg.from_account==patient.id]" id="{{msg.id}}" ng-cloak ng-if="msg.msgType==30">
									<div class="inquiry_hint" style="margin: 0 auto;">
										<p>
											抄方订单申请提交成功
										</p>
									</div>
								</li>
						</div>
					</ul>
				</ion-content>
			</div>
		</div>
		<div class="inquiry_bot" style="overflow: hidden;" ng-init="changeVideo=1" ng-show="((lastOrder.paymentStatus==2&&lastOrder.serverId==4)||(lastOrder.paymentStatus==2&&lastOrder.serverId==7))&&isSendShow==2&&lastOrder.isBlack==0">
			<a class="inquiry_voice" ng-click="changeVideo==1?changeVideo=2:changeVideo=1"></a>
			<div class="inquiry_write" ng-cloak>
				<input type="text" placeholder="请输入文字" readonly="readonly" ng-click="showSend($event,1)" ng-show="changeVideo==1"><a ng-show="changeVideo==2" style="user-select:none;" class="voideClick">按住说话</a>
			</div>
			<div class="inquiry_bot_icon" href="javascript:void(0);"><input type="file" accept="image/*"  onchange="fileOnChange(this);"></div>
<!-- 			<a class="inquiry_send" ng-click="sendMsg()">发送</a>
 -->		</div>
		<div class="history_bot" ng-show="lastOrder.isBlack==0&&((lastOrder.paymentStatus!=2&&lastOrder.syZxCount<=0&&(lastOrder.serverId==4||lastOrder.serverId==7||lastOrder.serverId==22))||(lastOrder.syZxCount<=0&&lastOrder.serverId!=4&&lastOrder.serverId!=7&&lastOrder.serverId!=22&&lastOrder.serverId!=8))">
			<a ng-click="zx()">线上咨询 {{lastOrder.twZxMoney | number:2}}元/{{lastOrder.twZxCount}}次</a>
			<a ng-click="tl()">线上调理{{lastOrder.fisrtTwGhMoney | number:2}}元/次</a>
		</div>
		
		<div class="consult_bot" ng-init="isShowzx=true" ng-show="!isShowzx&&((lastOrder.serverId!=4&&lastOrder.serverId!=7&&lastOrder.serverId!=22&&lastOrder.serverId!=8&&lastOrder.syZxCount>0)||(lastOrder.serverId==4&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)||(lastOrder.serverId==7&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)||(lastOrder.serverId==22&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)||(lastOrder.serverId==8&&lastOrder.syZxCount>0))&&isSendTexShow!=1">
			<div class="consult_question">
				<h3>您的问题：<span>本次使用后剩余{{lastOrder.syZxCount-1}}次</span></h3>
				<div class="symptom_fill consult_text">
					<div class="symptom_text">
						<p class="symptom_num"><span class="textCount" ng-bind="content.length"></span>/200</p>
						<textarea rows="2" placeholder="咨询次数有限，请珍惜每一次沟通 。" class="TextArea1" ng-model="content" readonly="readonly" ng-click="showTextSend($event,1)" ng-change="contentChange()" maxlength="200"></textarea>
					</div>
				</div>
			</div>
			<ul class="consult_img">
				<li>您的图片：</li>
				<li>
					<div class="consult_imglist" style="position: relative;">
						<a class="indetail_delete" onclick="deletePhoto(this);"></a>
						<img src="../../img/indetail_add.png">
						<input type="file" name="zx" accept="image/*"  onchange="uploadImages(this)" style="position: absolute;top: 0;left: 0;width: 100%;height: 3.78rem;opacity: 0;">
					</div>
				</li>
				<li>
					<div class="consult_imglist" style="position: relative;">
						<a class="indetail_delete" onclick="deletePhoto(this);"></a>
						<img src="../../img/indetail_add.png">
						<input type="file" name="zx" accept="image/*"  onchange="uploadImages(this)" style="position: absolute;top: 0;left: 0;width: 100%;height: 3.78rem;opacity: 0;">
					</div>
				</li>
				<li>
					<div class="consult_imglist" style="position: relative;">
						<a class="indetail_delete"  onclick="deletePhoto(this);"></a>
						<img src="../../img/indetail_add.png">
						<input type="file" name="zx" accept="image/*"  onchange="uploadImages(this)" style="position: absolute;top: 0;left: 0;width: 100%;height: 3.78rem;opacity: 0;">
					</div>
				</li>
			</ul>
			<div class="consult_btn">
				<a ng-click="isShowzx=true">取消</a>
				<a ng-class="{true:'consult_quiz'}[(content!=null&&content!='')||picNum>0]" ng-click="sendZx()">提问（{{lastOrder.syZxCount}}/{{lastOrder.zxCount}}）</a>
			</div>
	</div>
	<div>
	<div class="evalua_finish" style="background: #fff;" ng-show="lastOrder.isBlack==0&&isShowzx&&((lastOrder.serverId!=4&&lastOrder.serverId!=7&&lastOrder.serverId!=22&&lastOrder.syZxCount>0)||(lastOrder.serverId==4&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)||(lastOrder.serverId==7&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0)||(lastOrder.serverId==22&&lastOrder.paymentStatus==5&&lastOrder.syZxCount>0))">
		<button ng-click="isShowzx=false">点击咨询</button>
	</div>
	
	</div>
	
	<div class="inquiry_record inquiry_record1" style="display: none">
		<div class="inquiry_gif">
			<img src="../../img/inquiry_record.gif">
		</div>
		<p>手指上滑，取消发送</p>
	</div>
	
	<div class="inquiry_record inquiry_record2" style="display: none">
		<div class="inquiry_gif">
			<img src="../../img/cancel_send.png">
		</div>
		<p>松开手指，取消发送</p>
	</div>
	<div class="inquiry_record inquiry_record3" style="padding:0.5rem 2rem;display: none">
		<div class="inquiry_gif">
			<img src="../../img/time_short.png">
		</div>
		<p>说话时间太短</p>
	</div>
	
	
	<div id="symptom_describe" class="notice_back symptom"
		style="display: none;">
		<div class="inquiry_top">
			<div class="inquiry_photo" ng-click="toDoctor()">
				<img ng-src="{{doctor.docUrl}}">
			</div>
			<div class="inquiry_doctor" ng-cloak>
				<h3>{{doctor.docName  |limitTo:5}}<span>{{doctor.docPosition}}</span></h3>
				<p>{{doctor.infirmaryName}}</p>
			</div>
			<div class="inquiry_case">
				<h3 ng-bind="patient.name"></h3>
				<p ng-click="toCasehistory()">我的健康档案</p>
			</div>
		</div>
		<div class="symptom_con">
			<div class="symptom_main">
				<div class="symptom_hint">请您认真填写症状描述，以便医生更好地了解您的情况。<br>（本问诊单内容仅对{{doctor.docName  |limitTo:5}}医生开放，请放心填写。）</div>
				<div class="symptom_patient">
					<h3>就诊人</h3>
					<p ng-cloak>
						<span ng-bind="patient.name"></span>
						<span>{{patient.sex==1?'女':'男'}}</span>
						<span>{{patient.age}}岁</span>
						<span ng-bind="patient.phone"></span>
					</p>
				</div>
				<div class="symptom_fill">
					<h3>症状描述<span>1/3</span></h3>
					<div class="symptom_text">
						<textarea rows="3" class="TextArea1" ng-model="symptom.symptomDescribe"  onkeyup="words_deal();"  readonly="readonly"></textarea>
					</div>
				</div>
				<div class="symptom_fill">
					<h3>相关病史<span>2/3</span></h3>
					<div class="symptom_text">
						<textarea rows="3" class="TextArea1" ng-model="symptom.otherDescribe" onkeyup="words_deal();" readonly="readonly"></textarea>
					</div>
				</div>
				<div class="symptom_fill">
					<h3>测量脉搏<span>3/3</span></h3>
					<div class="symptom_count">
							<p>您的脉搏1分钟跳动次数。</p>
						</div>
						<div style="text-align: center;line-height: 2rem;padding-top: 0.5rem;width: 50%;margin: 0 auto;border-bottom: 1px solid #aaa;" ng-bind="symptom.pulse"></div>
				</div>
			</div>
		</div>
	</div>
	
	<div id="specialTest" class="notice_back symptom" style="display: none;">
		<div class="indetail_first" ng-if="null!=specialTest.testOption&&specialTest.testOption.length>0">
		<div class="inquiry_top indetail_top">
			<div class="inquiry_photo" ng-click="toDoctor()">
				<img ng-src="{{doctor.docUrl}}">
			</div>
			<div class="inquiry_doctor" ng-cloak>
				<h3>{{doctor.docName  |limitTo:5}}<span>{{doctor.docPosition}}</span></h3>
				<p>{{doctor.infirmaryName}}</p>
			</div>
			<div class="inquiry_case">
				<h3 ng-bind="patient.name"></h3>
				<p ng-click="toCasehistory()">我的健康档案</p>
			</div>
		</div>
		<ul class="indetail_step">
			<li class="step_on" ng-if="null!=specialTest.testOption&&specialTest.testOption.length>0">
				<span></span>
				<h3>详细问诊</h3>
				<p>{{checkNum}}/{{specialTest.testOption.length}}</p>
			</li>
			<li ng-if="1==specialTest.isSurface||1==specialTest.isTongue">
				<span></span>
				<h3>上传舌照/面照</h3>
				<p>{{specialTest.state==1?(specialTest.isSurface==1&&specialTest.isTongue==1?2:1):uploadNum}}/{{specialTest.isSurface==1&&specialTest.isTongue==1?2:1}}</p>
			</li>
			<li ng-if="1==specialTest.isOther">
				<span></span>
				<h3>其他资料</h3>
			</li>
		</ul>
		<div class="indetail_con">
			<div class="indetail_choice" ng-repeat="testOption in specialTest.testOption">
				<div class="indetail_issue" ng-if="testOption.optionType==1">
					<p class="indetail_page">{{$index+1}}/{{specialTest.testOption.length}}</p>
					<h3><span>Q{{$index+1>=10?$index+1:"0"+($index+1)}}</span>{{testOption.titleName}}</h3>
					<ul class="indetail_one">
						<li ng-class="{1:'indetail_check'}[options.checked]" ng-repeat="options in testOption.options" ng-click="checkRedio(options,testOption.options)">
							<span><i></i></span>
							<p ng-bind="options.optionName"></p>
						</li>
					</ul>
				</div>
				<div class="indetail_issue" ng-if="testOption.optionType==2">
					<p class="indetail_page">{{$index+1}}/{{specialTest.testOption.length}}</p>
					<h3><span>Q{{$index+1>=10?$index+1:"0"+($index+1)}}</span>{{testOption.titleName}}（可多选）</h3>
					<ul class="indetail_more">
						<li ng-class="{1:'indetail_check'}[options.checked]"  ng-repeat="options in testOption.options" ng-click="checkCheckBox(options)">
							<span><i></i></span>
							<p ng-bind="options.optionName"></p>
						</li>
					</ul>
				</div>
				<div class="indetail_issue" ng-if="testOption.optionType==3">
					<p class="indetail_page">{{$index+1}}/{{specialTest.testOption.length}}</p>
					<h3><span>Q{{$index+1>=10?$index+1:"0"+($index+1)}}</span>{{testOption.titleName}}</h3>
					<div class="indetail_text" ng-init="testOption.options[0].optionName=('null'!=testOption.options[0].optionName?testOption.options[0].optionName:'')">
						<textarea placeholder="请在此处填写" rows="4" ng-readonly="specialTest.state==1?true:false" ng-model="testOption.options[0].optionName" ng-change="getCheckNum()"></textarea>
					</div>
				</div>
			</div>
		</div>
		<div class="evalua_finish symptom_finish">
			<button class="next" ng-click="next($event,1)" ng-if="1==specialTest.isSurface||1==specialTest.isTongue||1==specialTest.isOther">下一步</button>
			<button ng-if="1!=specialTest.isSurface&&1!=specialTest.isTongue&&1!=specialTest.isOther&&specialTest.state!=1" ng-click="save()">完成</button>
		</div>
	</div>
	<div class="indetail_second" ng-class="{0:'symptom_describe'}[specialTest.testOption.length]" ng-if="1==specialTest.isSurface||1==specialTest.isTongue">
		<div class="inquiry_top indetail_top">
			<div class="inquiry_photo" ng-click="toDoctor()">
				<img ng-src="{{doctor.docUrl}}">
			</div>
			<div class="inquiry_doctor" ng-cloak>
				<h3>{{doctor.docName  |limitTo:5}}<span>{{doctor.docPosition}}</span></h3>
				<p>{{doctor.infirmaryName}}</p>
			</div>
			<div class="inquiry_case">
				<h3 ng-bind="patient.name"></h3>
				<p ng-click="toCasehistory()">我的健康档案</p>
			</div>
		</div>
		<ul class="indetail_step">
			<li class="step_on" ng-if="null!=specialTest.testOption&&specialTest.testOption.length>0">
				<span></span>
				<h3>详细问诊</h3>
				<p>{{checkNum}}/{{specialTest.testOption.length}}</p>
			</li>
			<li class="step_on" ng-if="1==specialTest.isSurface||1==specialTest.isTongue">
				<span></span>
				<h3>上传舌照/面照</h3>
				<p>{{specialTest.state==1?(specialTest.isSurface==1&&specialTest.isTongue==1?2:1):uploadNum}}/{{specialTest.isSurface==1&&specialTest.isTongue==1?2:1}}</p>
			</li>
			<li ng-if="1==specialTest.isOther">
				<span></span>
				<h3>其他资料</h3>
			</li>
		</ul>
		<div class="photo_shoot indetail_shoot" ng-if="1==specialTest.isTongue">
			<h3 class="photo_title">请上传舌照</h3>
			<ul class="photo_add indetail_add">
				<li ng-repeat="tongue in specialTest.tongue">
					<div class="photo_photo">
						<img ng-src="{{tongue.picPathUrl}}">
					</div>
				</li>
				<li ng-if="2==specialTest.state">
					<div class="photo_photo">
						<img src="../../img/indetail_add.png">
						<input type="file" accept="image/*"  name="tongue" onchange="setImagePreview(this,1,2)">
						<input type="tetx" name="tongueUrl">
					</div>
					<p>点击添加</p>
				</li>
				<li ng-if="2==specialTest.state">
					<div class="photo_photo">
						<img src="../../img/indetail_add.png">
						<input type="file" accept="image/*"  name="tongue" onchange="setImagePreview(this,1,2)">
						<input type="tetx" name="tongueUrl">
					</div>
					<p>点击添加</p>
				</li>
			</ul>
			<div class="indetail_example">
				<h3>舌照提示</h3>
				<p>拍摄时请选择高清摄像头并关闭美颜功能  </p>
				<p>请在自然光线下拍摄，拍照时请尽量张大嘴巴 </p>
				<p>为获得最佳效果，拍舌顶照时，请尽量向下伸长舌头</p>
				<p>为获得最佳效果，拍舌底照时，请尽量向上抬起舌头</p>
				<ul class="indetail_show">
					<li>
						<img src="../../img/indetail_img1.png">
						<span>示例图片</span>
					</li>
					<li>
						<img src="../../img/indetail_img2.png">
						<span>示例图片</span>
					</li>
					<li>
						<img src="../../img/indetail_img3.png">
						<span>示例图片</span>
					</li>
					<li>
						<img src="../../img/indetail_img4.png">
						<span>示例图片</span>
					</li>
				</ul>
			</div>
		</div>
		<div class="photo_shoot indetail_shoot"  ng-if="1==specialTest.isSurface">
			<h3 class="photo_title">请上传正面照</h3>
			<ul class="photo_add indetail_add">
				<li ng-repeat="surface in specialTest.surface">
					<div class="photo_photo">
						<img ng-src="{{surface.picPathUrl}}">
					</div>
				</li>
				<li ng-if="2==specialTest.state">
					<div class="photo_photo">
						<img src="../../img/indetail_add.png">
						<input type="file" accept="image/*"  name="surface" onchange="setImagePreview(this,1,2)">
						<input type="text" name="surfaceUrl">
					</div>
					<p>点击添加</p>
				</li>
				<li ng-if="2==specialTest.state">
					<div class="photo_photo">
						<img src="../../img/indetail_add.png">
						<input type="file" accept="image/*"  name="surface" onchange="setImagePreview(this,1,2)">
						<input type="text" name="surfaceUrl">
					</div>
					<p>点击添加</p>
				</li>
			</ul>
			<div class="indetail_example">
				<h3>面照提示</h3>
				<p>请在自然光线下拍摄正面素颜照片拍摄时请选择高清摄像头并关闭美颜功能</p>
				<p>如有需要可上传其他患部清晰照片</p>
				<ul class="indetail_show">
					<li>
						<img src="../../img/indetail_img5.png">
						<span>示例图片</span>
					</li>
					<li>
						<img src="../../img/indetail_img6.png">
						<span>示例图片</span>
					</li>
					<li>
						<img src="../../img/indetail_img7.png">
						<span>示例图片</span>
					</li>
					<li>
						<img src="../../img/indetail_img8.png">
						<span>示例图片</span>
					</li>
				</ul>
			</div>
		</div>
		<div class="scheme_btn  indetail_btn" ng-class="{true:'width_a'}[(1==specialTest.isOther&&1!=specialTest.isOther&&specialTest.state!=1)||(specialTest.testOption.length>0&&1==specialTest.isOther)||(specialTest.testOption.length>0&&1!=specialTest.isOther&&specialTest.state!=1)]">
			<a class="prev" ng-click="prev($event)" ng-if="specialTest.testOption.length>0">上一步</a>
			<a class="next" ng-click="next($event,2)" ng-if="1==specialTest.isOther">下一步</a>
			<a ng-if="1!=specialTest.isOther&&specialTest.state!=1" ng-click="save()">完成</a>
		</div>
	</div>
	<div class="indetail_third" ng-class="{true:'symptom_describe'}[specialTest.testOption.length==0&&1!=specialTest.isTongue&&1!=specialTest.isSurface]" ng-if="1==specialTest.isOther">
		<div class="inquiry_top indetail_top">
			<div class="inquiry_photo" ng-click="toDoctor()">
				<img ng-src="{{doctor.docUrl}}">
			</div>
			<div class="inquiry_doctor" ng-cloak>
				<h3>{{doctor.docName  |limitTo:5}}<span>{{doctor.docPosition}}</span></h3>
				<p>{{doctor.infirmaryName}}</p>
			</div>
			<div class="inquiry_case">
				<h3 ng-bind="patient.name"></h3>
				<p ng-click="toCasehistory()">我的健康档案</p>
			</div>
		</div>
		<ul class="indetail_step">
			<li class="step_on" ng-if="null!=specialTest.testOption&&specialTest.testOption.length>0">
				<span></span>
				<h3>详细问诊</h3>
				<p>{{checkNum}}/{{specialTest.testOption.length}}</p>
			</li>
			<li class="step_on" ng-if="1==specialTest.isSurface||1==specialTest.isTongue">
				<span></span>
				<h3>上传舌照/面照</h3>
				<p>{{specialTest.state==1?(specialTest.isSurface==1&&specialTest.isTongue==1?2:1):uploadNum}}/{{specialTest.isSurface==1&&specialTest.isTongue==1?2:1}}</p>
			</li>
			<li class="step_on" ng-if="1==specialTest.isOther">
				<span></span>
				<h3>其他资料</h3>
			</li>
		</ul>
		<div class="photo_shoot indetail_other">
			<h3><span>您可在此上传病历、化验单或其他检查报告</span><!-- p ng-bind="specialTest.otherName"></p> --></h3>
			<ul class="photo_add">
				<li ng-repeat="other in specialTest.other">
					<div class="photo_photo">
						<img ng-src="{{other.picPathUrl}}">
					</div>
				</li>
				<li ng-if="2==specialTest.state">
					<div class="photo_photo">
						<img src="../../img/indetail_add.png">
						<input type="file" accept="image/*"  name="other" onchange="setImagePreview(this,8,1)">
						<input type="text" name="otherUrl">
					</div>
					<p>点击添加</p>
				</li>
			</ul>
		</div>
		<div class="scheme_btn inquiry_btn" ng-class="{true:'width_a'}[(specialTest.testOption.length>0||1==specialTest.isTongue||1==specialTest.isSurface)&&specialTest.state!=1]">
			<a class="prev" ng-if="specialTest.testOption.length>0||1==specialTest.isTongue||1==specialTest.isSurface" ng-click="prev($event)">上一步</a>
			<a ng-if="specialTest.state!=1" ng-click="save()">完成</a>
		</div>
	</div>
	</div>
	
	<div class="inquiry_text" ng-show="isSendShow==1" ng-click="showSend($event,1)">
		<div class="inquiry_area">
			<textarea id="inputFocus" autofocus  rows="4" ng-model="content"  placeholder="请输入文字" ></textarea>
		</div>
		<div class="inquiry_textbot">
			<span></span>
			<button ng-click="sendMsg(1)">发送</button>
		</div>
	</div>
	
	<div class="inquiry_text" ng-show="isSendTexShow==1" ng-click="showTextSend($event,1)">
		<div class="inquiry_area">
			<textarea id="textFocus" autofocus maxlength="200"  rows="4" ng-model="content"  placeholder="请输入文字" ></textarea>
		</div>
		<div class="inquiry_textbot">
			<span></span>
			<button ng-click="showTextSend($event,2)">确定</button>
		</div>
	</div>
	
	</div>
	<script src="../../js/inquiry/inquiry.js"></script>
	<script src="../../js/foot.js"></script>
	<script type="text/javascript">
	
		function isIphoneX(){
		    return /iphone/gi.test(navigator.userAgent) && (screen.height == 812 && screen.width == 375)
		}
		$(function() {
		    setTimeout(function(){
		    	var H = $(window).height() - $(".inquiry_top").height() - 50;
		    	if(isIphoneX&&$(window).height()==724){
			    	H=H-50;
			    }
				$(".inquiry_con").height(H);
				
				$(".symptom").height($(window).height());
				$(".indetail_first,.indetail_second,.indetail_third").height($(window).height());
				if(isIphoneX&&$(window).height()==724){
			    	$(".inquiry_bot").css("bottom","50px");
			    }
		    },200);
		});
		
		
	</script>
</body>
</html>